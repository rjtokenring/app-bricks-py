services:
  ei-motion-detection-runner:
    image: ${DOCKER_REGISTRY_BASE:-ghcr.io/arduino/}app-bricks/ei-models-runner:0.6.0
    logging:
      driver: "json-file"
      options:
        max-size: "5m"
        max-file: "2"     
    devices:
      - "/dev/dri:/dev/dri"
    group_add:
      - "render"    
    ports:
      - ${BIND_ADDRESS:-127.0.0.1}:1341:1337
    volumes:
      - "${CUSTOM_MODEL_PATH:-/home/arduino/.arduino-bricks/ei-models}:${CUSTOM_MODEL_PATH:-/home/arduino/.arduino-bricks/ei-models}"
    command: ["--model-file", "${EI_MOTION_DETECTION_MODEL:-/models/ootb/ei/updown-wave-motion-detection.eim}", "--run-http-server", "1337", "--dont-print-predictions"]
    healthcheck:
      test: [ "CMD-SHELL", "wget -q --spider http://localhost:1337/api/info || exit 1" ]
      interval: 2s
      timeout: 2s
      retries: 25
